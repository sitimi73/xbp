:root {
    /* 色のバリエーション (変更なし) */
    --color-1: #2e8b57; --color-2: #4682b4; --color-3: #cd5c5c; --color-4: #800080;
    --color-5: #d2691e; --color-6: #6a5acd; --color-7: #4b0082; --color-8: #b22222;
    --color-9: #008b8b; --color-10: #a52a2a; 

    /* 木材の色 */
    --shelf-wood-dark: #654321;
    --shelf-wood-light: #8B4513;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
    overflow: hidden;
}

/* 3D空間の視点 (シーン全体) - 本のアニメーション用 */
.scene {
    perspective: 2000px; /* 本が飛び出す時の3D効果のために維持 */
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* 本棚全体 - 傾きをなくし、完全に正面向きに */
.bookshelf {
    position: relative;
    width: 100vw;
    height: 100vh;
    /* transform-style: preserve-3d; */ /* 本棚自体は2Dなので不要 */
    transform: none; /* 傾きを削除 */
    background-color: var(--shelf-wood-dark);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    display: grid;
    grid-template-rows: 1fr 1fr 1fr;
    gap: 0;
    padding: 20px 50px;
    box-sizing: border-box;
}

/* 各棚の段 */
.shelf-row {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d; /* 本のアニメーションのために子要素に継承 */
    display: flex;
    align-items: flex-end; /* 本を棚の底にぴったり合わせる */
    /* padding-bottom: 20px; */ /* 棚板の厚みは棚板のbottomで調整するため不要 */
    box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.3), inset 0 5px 10px rgba(0, 0, 0, 0.1);
}

/* 棚板の装飾 */
.shelf-edge { 
    position: absolute; 
    width: 100%; 
    height: 20px; 
    background-color: var(--shelf-wood-light); 
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); 
    transform: translateZ(20px); 
    left: 0; 
}
.shelf-edge-top { top: 0; }
.shelf-edge-middle-1 { top: calc(33.33% - 10px); }
.shelf-edge-middle-2 { top: calc(66.66% - 10px); }
.shelf-edge-bottom { bottom: 0; }


/* -------------------------------------- */
/* 本のスタイル (背表紙の2D表現) */
/* -------------------------------------- */

.book {
    --h: var(--b-height);
    --w: var(--b-width);
    --c: var(--b-color);
    
    position: relative; /* absoluteからrelativeに変更してflexアイテムとして配置 */
    /* transform-style: flat; */ /* 不要 */
    
    width: var(--w); /* 厚さが幅になる */
    height: var(--h);
    
    /* transform: translateY(calc(var(--h) * -1)); */ /* flexboxで下揃えになるので不要 */
    
    background-color: var(--c);
    border: 1px solid rgba(0, 0, 0, 0.2);
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    
    /* 縦書きのタイトル */
    writing-mode: vertical-rl;
    color: white;
    font-size: 14px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    padding: 5px 0;
    overflow: hidden;

    /* アニメーション設定 */
    transition: transform 1s ease-in-out, box-shadow 0.3s, background-image 0.3s;
    cursor: pointer;
    text-decoration: none;
    z-index: 10;
}

/* -------------------------------------- */
/* クリック時のアニメーション (2D -> 3D変形) */
/* -------------------------------------- */

.book.is-open {
    /* relative配置なので、transform-originは中央基準でOK */
    transform-origin: center center;

    /* Z軸を前に出し、Y軸で回転して3Dの側面を見せる */
    transform: translateZ(500px)    /* 手前に飛び出す */
               translateX(-300px)   /* 画面左に移動 */
               rotateY(20deg)       /* 側面を見せるための回転 */
               scale(1.1);          /* 少し大きくする */
    
    /* 本の立体感のためのシャドウ */
    box-shadow: -20px 20px 30px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    
    /* 背表紙の表現を強化 */
    background-image: linear-gradient(to right, rgba(0,0,0,0.2), rgba(255,255,255,0.2));
}

/* アニメーション中はクリックを無効にする */
.book.animating {
    pointer-events: none;
}